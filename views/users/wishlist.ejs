<%- include('../partials/userHeader')%>
<style>
  
  .profilepic {
    position: relative;
    width: 125px;
    height: 125px;
    border-radius: 50%;
    overflow: hidden;
    background-color: #111;
    
  }
  
  .profilepic:hover .profilepic__content {
    opacity: 1;
  }
  
  .profilepic:hover .profilepic__image {
    opacity: .5;
  }
  
  .profilepic__image {
    object-fit: fill;
    opacity: 1;
    transition: opacity .2s ease-in-out;
  }
  
  .profilepic__content {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    opacity: 0;
    transition: opacity .2s ease-in-out;
  }
  
  .profilepic__icon {
    color: white;
    padding-bottom: 8px;
  }
  
  .fas {
    font-size: 20px;
  }
  
  .profilepic__text {
    text-transform: uppercase;
    font-size: 12px;
    width: 50%;
    text-align: center;
  } 
  
  </style>
<section style="background-color: #eee;">
    <div class="container py-5">
      <div class="row">
        <div class="col">
          <nav aria-label="breadcrumb" class="bg-light rounded-3 p-3 mb-4">
            <ol class="breadcrumb mb-0">
              <li class="breadcrumb-item"><a href="/">Home</a></li>

              <li class="breadcrumb-item active" aria-current="page">Wishlist</li>
            </ol>
          </nav>
        </div>
      </div>
  
      <div class="row">
        <div class="col-lg-4">
          <div class="card mb-4">
            <div class="card-body text-center">
              <div class="d-flex justify-content-center">
                <div class="profilepic d-flex justify-content-center ">
                  
                  <img class="" src="/uploads/<%-user.dp.filename%>" alt="avatar">
    
                  </div></div>
              <h5 class="my-3"><%-user.username%></h5>

              <div class="form-control d-flex justify-content-between border" >
                <span class="fs-6 fw-bold text-dark align-self-center d-flex" id="refferalId"><%-user.referral_code%></span>
                <button class="btn px-3 text-dark" onclick="CopyToClipboard('refferalId');return false;">Copy</button>
              </div>
              <p class="text-muted m-0 text-center" style="font-size: 13px;">Share your refferal Id to win ₹<%-referral.referrer_offer%>/- wallet  balance</p>
            </div>
          </div>


          <div class="card mb-4 ">
            <div class="card-body p-4 d-flex justify-content-between align-items-center">
              <i class="fa-solid fa-wallet fa-xl"><span class="fs-6  logo"> Wallet</span> </i>
              <span>Balance:<span class="fs-4 fw-bold"> ₹ <%-user.wallet%>/-</span></span>
            </div>
          </div>
          <div class="card mb-4 mb-lg-0">
            <div class="card-body p-0">
              <ul class="list-group list-group-flush rounded-3">
                <li class="list-group-item d-flex px-5  align-items-center p-3">
                    <i class="fa-solid fa-calendar mx-2 text-dark"></i>
                  <a href="/orders"><p class="mb-0 fw-bold text-dark">MY ORDERS</p></a>
                </li>
                <!-- <li class="bg-light list-group-item d-flex px-5  align-items-center p-3">
                  <i class="fa-solid fa-heart mx-2 text-primary"></i>
                <a href="/wishlist"><p class="mb-0 fw-bold text-primary">MY WISHLIST</p></a>
              </li> -->
                <li class="list-group-item d-flex px-5  align-items-center p-3">
                  <i class="fa-solid fa-user-gear mx-2 text-dark"></i>
                  <p class="mb-0 fw-bold text-dark"> ACCOUNT SETTINGS</p>
                </li>
                <li class="  list-group-item d-flex px-5 mx-5 align-items-center p-3">
                    <i class="fa-regular fa-circle-dot mx-2 text-dark"></i>
                    <a href='/userProfile'> <p class="mb-0 text-dark">Profile Information</p></a>
                </li>
                <li class="list-group-item d-flex px-5 mx-5 align-items-center p-3">
                    <i class="fa-regular fa-circle-dot mx-2 text-dark"></i>
                    <a href='/viewAddress'><p class="mb-0 text-dark">Manage Addresses</p></a>
                </li>
                <li class="list-group-item d-flex px-5 mx-5 align-items-center p-3">
                    <i class="fa-regular fa-circle-dot mx-2 text-dark"></i>
                    <a href="/changePassword"><p class="mb-0 text-dark">Change Password </p></a>
                </li>

                <li class="list-group-item d-flex px-5  align-items-center p-3">
                  <i class="fa-solid fa-id-card-clip mx-2 text-primary"></i>
                  <p class="mb-0 fw-bold text-primary"> MY STUFFS</p>
                </li>
                <li class="  list-group-item d-flex px-5 mx-5 align-items-center p-3">
                    <i class="fa-regular fa-circle-dot mx-2 text-dark"></i>
                    <a href='/myCoupons'> <p class="mb-0 text-dark">My Coupons</p></a>
                </li>
                <li class="bg-light list-group-item d-flex px-5 mx-5 align-items-center p-3">
                    <i class="fa-regular fa-circle-dot mx-2 text-primary "></i>
                    <a href='/wishlist'><p class="mb-0 text-primary">My Wishlist</p></a>
                </li>
                <li class="list-group-item d-flex px-5 mx-5 align-items-center p-3">
                    <i class="fa-regular fa-circle-dot mx-2 text-dark"></i>
                    <a href=""><p class="mb-0 text-dark">Ratings And Reviews</p></a>
                </li>
                <li class="list-group-item d-flex px-5 align-items-center p-3">
                    <i class="fa-solid fa-right-from-bracket mx-2 text-dark"></i>
                    <a href="/userLogout"><p class="mb-0 fw-bold text-dark">LOGOUT</p></a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- wishlist -->

        <div class="col-lg-8">
            <% if(wishlistItems.length>0){%>
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col"><h4><b>My Wishlist</b></h4></div>
                    <div class="col align-self-center d-flex justify-content-end text-muted"><%-wishlistItems.length%> items</div>
                    <% for(let p of wishlistItems){%>
                        <div class="row border-top border-bottom">
                            <div class="row main  p-3">
                                <div class="col-2">
                                    <div class="bg-image hover-zoom ripple rounded ripple-surface">
                                        <img src="/uploads/<%-p.products.images[0].filename%>"
                                          class="w-100" />
                                        <a href="/productDetails/<%-p.products._id%>">
                                          <div class="hover-overlay">
                                            <div class="mask" style="background-color: rgba(253, 253, 253, 0.15);"></div>
                                          </div>
                                        </a>
                                      </div>
                                </div>
                                <div class="col-md-6">
                                  <p class="row text-danger fw-bold"><%- p.products.subCategoryName%></p>
                                    <div class="row text-dark fw-bold"><%- p.products.name%>(<%- p.products.categoryName%>)</div>
                                    <div class="col mt-3 text-dark fw-bold">₹ <%- p.products.sellingprice%> <span class="text-muted"><strike>₹<%- p.products.actualprice%></strike></span>
                                    </div>
                                   
                                </div>
                                <div class="col-md-4 d-flex align-items-center justify-content-between">
                                  

                                  <div>
                                    <%if(p.inCart){%>
                                    <a href="/cart" class="btn btn-secondary">Go to Cart</a>
                                    <%}else{%>
                                    <a onclick="addItemToCart('<%-p.products._id%>','<%-user._id%>')" class="btn btn-secondary">Add to Cart</a>
                                    <%}%>
                                  </div>  
                                  <div ><a role="button" title="Remove from wishlist" onclick="confirmation('<%-p.products._id%>')"> <span class="close"><i class="fa-solid fa-trash text-danger"></i></span></a></div>
                                   
                                  
                                  </div>

                            </div>
                        </div>
                       <%}%>
                    </div>
                </div>
            </div>
            
            <%}else{%>
            <div class="card mb-4">
                <div class="card-body">
                    
                            <section class="container my-5" style="width: 35rem;">
      
          
                                <div class="text-center">
                                    <img src="/images/cartempty.webp" class="img-fluid">
                                  <h5 class="card-title">Your wishlist is empty!!</h5>
                                  <p class="card-text">Go add your favorites and purchase</p>
                                  <a href="/" class="btn  btn-primary px-5">Continue Shopping</a>
                                </div>
                               
                              
                            </section>
                           
                        
                </div>
            </div>
            <%}%>
        </div>

        <!-- wishlist -->
  </section>
  <%- include('../partials/footer')%>

<script>

function confirmation(proId){
    
    Swal.fire({
    title: 'Are you sure?',
    text: "You want to remove this item wishlist!",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Yes, remove it!'
  }).then((result) => {
    if (result.isConfirmed) {
      sessionStorage.setItem("reloading", "true");
    location.href=`/deleteWishlist/${proId}`
    }
  })
  }


  
  function myFunction() {
            alertify.success('Removed Product From Wishlist');
          }
          
        window.onload = function () {
            var reloading = sessionStorage.getItem("reloading");
            if (reloading) {
              sessionStorage.removeItem("reloading");
              myFunction();
            }
          }

  function addItemToCart(proId,userId){
    console.log('heyy kuttaa')
    $.ajax({
      url:'/add-item-to-cart',
      data:{
        proId,
       userId
      },
      method:'post',
      success:(response)=>{
        location.reload()
      }
    })
  }
  
</script>





